<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ring Ceremony Live Slideshow üíç</title>
<style>
  body {
    margin: 0;
    background: black;
    display: flex;
    justify-content: center;
    align-items: center;
    height: 100vh;
    overflow: hidden;
  }
  img {
    max-width: 100%;
    max-height: 100%;
    position: absolute;
    transition: opacity 1s ease-in-out;
    opacity: 0;
  }
  img.active { opacity: 1; }
</style>
</head>
<body>

<script>
const FEED_URL = "https://script.google.com/macros/s/AKfycbzyZgUpAoEDoYIbHBNBvSWlItlfAhT9E6v_3roIEcTfPWLqvIahS2QbuNyQkLac4mfA/exec"; // üîπ Replace with your Apps Script URL
const SLIDE_INTERVAL = 4000;
const REFRESH_INTERVAL = 60000; // Refresh image list every 1 min
let images = [];
let imgElems = [];
let current = 0;

// Fetch images from Apps Script JSON feed
async function fetchImages() {
  try {
    const res = await fetch(FEED_URL + "?t=" + Date.now()); // prevent caching
    const data = await res.json();
    console.log('data', data)

    // Extract ID from each URL using regex
const ids = data.map(img => {
    const match = img.url.match(/id=([a-zA-Z0-9_-]+)/);
    return match ? match[1] : null;
}).filter(id => id !== null);

    console.log('ids----', ids);
    // Map to thumbnail URLs
    images = ids.map(id => `https://drive.google.com/thumbnail?id=${id}&sz=w1000`);


    console.log('images', images)
    preloadImages();
  } catch (e) {
    console.error("Failed to fetch images:", e);
  }
}

// Preload images into DOM
function preloadImages() {
  document.querySelectorAll("img").forEach(el => el.remove());
  imgElems = images.map((url, i) => {
    const el = document.createElement("img");
    el.src = url;
    if (i === 0) el.classList.add("active");
    document.body.appendChild(el);
    return el;
  });
  current = 0;
}

// Show next slide
function showNext() {
  if (imgElems.length === 0) return;
  imgElems[current].classList.remove("active");
  current = (current + 1) % imgElems.length;
  imgElems[current].classList.add("active");
}

// Initialize slideshow
fetchImages();
setInterval(showNext, SLIDE_INTERVAL);
setInterval(fetchImages, REFRESH_INTERVAL); // auto-refresh new uploads
</script>

</body>
</html>
